---
title: "Comparing Students' Grades"
author: "Jay Ralyea, William Cull, and John Hope"
date: "5/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) # whole bunch of useful packages
library(tidymodels)
library(modelr)
library(randomForest) # builds random forest models
library(caret) # builds models and partitions data
library(viridis)
```



```{r}
## Load in the data
math <- read_csv("student-mat.csv")
por <- read_csv("student-por.csv")

## Data exploration
quantile(math$G3)
quantile(por$G3)

## Percent zeros
table(math$G3)[1] / nrow(math)
table(por$G3)[1] / nrow(por)

## Factor variables in each dataset
factors <- c("school", "sex", "address", "famsize", "Pstatus", "Medu",
             "Fedu", "Mjob", "Fjob", "reason", "guardian", "traveltime",
             "studytime", "failures", "schoolsup", "famsup", "paid",
             "activities", "nursery", "higher", "internet", "romantic")

math[factors] <- sapply(math[factors], as.factor)
por[factors] <- sapply(por[factors], as.factor)

## Remove G1 and G2 grades (determine G3 grade)
math <- math %>%
  select(-G1, -G2)
por <- por %>%
  select(-G1, -G2)
  
```



```{r}
## EDA


# School
math.school <- math %>%
  group_by(school) %>%
  summarise(mean = mean(G3))
math.school %>%
  ggplot(aes(x = school, y = mean, fill = school)) + 
  geom_bar(stat = "identity")

por %>%
  group_by(school) %>%
  summarise(mean = mean(G3)) %>%
  ggplot(aes(x = school, y = mean, fill = school)) + 
  geom_bar(stat = "identity")


# Parental job
math %>%
  ggplot(aes(x = Mjob, y = G3, fill = Fjob)) + 
  geom_bar(stat = "summary", fun.y = "mean", position = "dodge") + 
  scale_fill_viridis_d() +
  labs(title = "Mean G3 Score Based on Mother's Job and Father's Job",
       x = "Mother's Job", y = "Mean G3 Score", fill = "Father's Job") +
  theme_bw() +
  scale_y_continuous(breaks = seq(0, 18, by = 2)) +
  coord_cartesian(ylim = c(0,16))

por %>%
  ggplot(aes(x = Mjob, y = G3, fill = Fjob)) + 
  geom_bar(stat = "summary", fun.y = "mean", position = "dodge") + 
  scale_fill_viridis_d() +
  labs(title = "Mean G3 Score Based on Mother's Job and Father's Job",
       x = "Mother's Job", y = "Mean G3 Score", fill = "Father's Job") +
  theme_bw() +
  scale_y_continuous(breaks = seq(0, 18, by = 2)) +
  coord_cartesian(ylim = c(0,16))


# Address
math %>%
  ggplot(aes(x = address, y = G3, fill = address)) + 
  geom_bar(stat = "summary", fun.y = "mean") +
  scale_fill_viridis_d() + 
  theme_bw() + 
  labs(title = "Mean G3 Score for Different Addresses", 
       x = "Address Location", y = "Mean G3 Score", fill = "Address Location")

por %>%
  ggplot(aes(x = address, y = G3, fill = address)) + 
  geom_bar(stat = "summary", fun.y = "mean") +
  scale_fill_viridis_d() + 
  theme_bw() + 
  labs(title = "Mean G3 Score for Different Addresses", 
       x = "Address Location", y = "Mean G3 Score", fill = "Address Location")

# Different Subjects



```



```{r}
## Change the G3 score to be low, moderate, or high
math$binned <- cut(math$G3,
    breaks = c(-Inf, 7, 13, Inf),
    labels = c("low", "middle", "high"))
por$binned <- cut(por$G3,
                  breaks = c(-Inf, 7, 13, Inf),
                  labels = c("low", "middle", "high"))
```








```{r}
## Split the data for model building

## Create the partition
set.seed(2000) # ensure reproducibility
math.part <- createDataPartition(math$G3, times=1, p=0.8, list=FALSE)
set.seed(2000) # ensure reproducibility
por.part <- createDataPartition(por$G3, times=1, p=0.8, list = FALSE)

## Math training and testing data
math.training <- math[math.part,]
math.test <- math[-math.part,]

## Portuguese training and testing data
por.training <- por[por.part,]
por.test <- por[-por.part,]
```



































